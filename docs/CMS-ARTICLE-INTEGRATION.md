# 記事コンテンツ × CMS 連携ガイド

Gemini で記事を作成し CMS に直接入れる場合の、**フクロウの相槌**と**LINE誘導**の扱い方をまとめます。

---

## 1. LINE誘導（上部・下部）→ **CMSには入れない**

### 現在の仕組み

- **記事上部のLINE CTA**  
  - アイキャッチ画像の直後に、**記事テンプレート側で固定**で表示しています（`ArticleLineCTATop`）。
- **記事下部のLINE CTA**  
  - 本文の下・フッター内で、**記事テンプレート側で固定**で表示しています（`ArticleFooterCTA`）。

どちらも「記事ページのレイアウト」の一部なので、**CMS の本文（body）には含めません**。

### 運用ルール

| 項目 | 入れる場所 | 備考 |
|------|------------|------|
| 記事本文（見出し・段落・リストなど） | **CMS の body** | Gemini が生成する本文のみ |
| 上部「LINEで今すぐ受け取る」バナー | **入れない** | テンプレートで常に表示 |
| 下部「LINEで友達追加して特典をもらう」など | **入れない** | テンプレートで常に表示 |

**Gemini への指示例：**  
「記事本文のみを出力すること。LINEの案内やバナー、『友だち追加』などの文言は書かず、見出し・段落・リストだけをHTMLで出力してください。」

---

## 2. フクロウの相槌 → **2パターンから選択**

相槌は「**各段落の直後**」に、サイト側で自動的に差し込んでいます。CMS からどう渡すかで2通りあります。

### パターンA：相槌を指定しない（おすすめ・手軽）

- **CMS に渡すもの**: `body`（本文HTML）だけ。
- **相槌**: サイト側で **デフォルトの一言** を段落ごとにループで表示します。

デフォルトで使われる文言の例：

- 「うんうん」「なるほど」「そうなんですね」「その通りだホー」「いいですね」「わかります」「まずは一歩からで大丈夫です」「その調子です」

→ **Gemini では本文だけ作成すればよく、相槌用のフィールドは不要**です。

---

### パターンB：相槌を記事ごとに指定する

- **CMS に渡すもの**: `body` に加え、**`owlMessages`**（文字列の配列）。
- **ルール**: 配列の長さは **段落数と揃える**。  
  - `owlMessages[0]` → 1段落目の直後  
  - `owlMessages[1]` → 2段落目の直後  
  - … 以下同様

**CMS の記事スキーマ例：**

```json
{
  "slug": "example-article",
  "title": "記事タイトル",
  "description": "記事の説明",
  "category": "進め方",
  "date": "2026-02-14",
  "body": "<p>1段落目...</p><p>2段落目...</p><p>3段落目...</p>",
  "owlMessages": [
    "なるほど、そこがポイントですね",
    "その通りです。次のステップは…",
    "まずは一歩からで大丈夫です"
  ]
}
```

**Gemini への指示例：**

- 「記事本文を HTML の `<p>` タグで出力してください。そのうえで、**段落ごとに、その直後に表示する『フクロウの相槌』を1つずつ、短い一文で出力**してください。相槌は配列で渡し、本文の段落の順番と対応させてください。例：['なるほど', 'その通りだホー', 'まずは一歩からで大丈夫です']」

**注意**:  
- `owlMessages` の数が段落数より少ない場合は、不足分はサイト側のデフォルトで補います。  
- 多すぎる分は使われません（段落数に合わせて表示）。

---

## 3. まとめ：CMS に持たせるフィールド

| フィールド | 必須 | 説明 |
|------------|------|------|
| slug | ○ | 記事の一意なキー（URL の一部） |
| title | ○ | タイトル |
| description | ○ | メタ説明・OG用 |
| category | ○ | カテゴリ（進め方／処分・買取／資産・家／デジタル など） |
| date | ○ | 公開日（YYYY-MM-DD） |
| body | ○ | 本文 HTML（**LINE誘導の文言は含めない**） |
| eyecatch | 任意 | アイキャッチ画像 URL |
| images | 任意 | 記事中画像（afterIndex, src, alt） |
| **owlMessages** | 任意 | 段落ごとのフクロウの相槌。省略時はサイト側でデフォルトを表示 |
| tags | 任意 | 状況別タグ（long-distance, save-money など） |

- **LINE誘導**  
  - 上部・下部とも **CMS には持たせず、記事テンプレートで固定表示**。  
- **フクロウの相槌**  
  - **省略可**（デフォルト相槌を使用）  
  - **指定する場合**は `owlMessages` を段落順の配列で CMS に格納。

この設計にしておけば、Gemini は「本文＋必要なら owlMessages」だけを CMS 用に出力し、LINE やレイアウトはすべてサイト側で一貫して制御できます。

---

## 4. Sanity（および他 Headless CMS）で「フクロウ・LINE」を残すには

**結論：Sanity でも問題なく残せます。** データの持ち方と表示の役割を分けておけば、どの Headless CMS でも同じ設計でいけます。

### フクロウの相槌（owlMessages）

| 項目 | 内容 |
|------|------|
| **CMS での持ち方** | 記事ドキュメントに **「文字列の配列」** フィールドを1つ持つ。 |
| **Sanity の場合** | スキーマで `name: 'owlMessages'`, `type: 'array'`, `of: [{ type: 'string' }]` を定義する。管理画面で「段落1の相槌」「段落2の相槌」… と追加できる。省略可能（空ならサイト側でデフォルト相槌を使用）。 |
| **表示** | Next.js の記事ページで、CMS から取得した `article.owlMessages` をそのまま `ArticleBodyWithOwl` に渡す。現在の JSON 記事と同じ使い方。 |

→ **現状の「段落ごとの相槌」を Sanity の array フィールドで再現できる**ので、フクロウの相槌はそのまま残せます。

### LINE誘導（文頭・文末）

| 項目 | 内容 |
|------|------|
| **CMS に持たせるか** | **持たせない**。LINE の文言・バナーは「記事テンプレートのレイアウト」なので、CMS の body や別フィールドには入れない。 |
| **表示** | 記事を CMS（Sanity）から取得したあと、**同じレイアウト**で表示する。つまり「アイキャッチ → ArticleLineCTATop（文頭）→ 本文＋フクロウ → ArticleFooterCTA（文末）」の順は、現在の `app/articles/[slug]/page.tsx` と同じ。データ取得先が JSON から Sanity API に変わるだけ。 |
| **Sanity でやること** | 特になし。記事の slug / title / body / owlMessages などを返す API を用意し、Next 側でそのデータを使って既存の `ArticleLineCTATop`・`ArticleBodyWithOwl`・`ArticleFooterCTA` をそのまま使う。 |

→ **LINE誘導は CMS にデータを持たせず、テンプレートで固定表示する設計のまま**なので、Sanity に移行しても文頭・文末の LINE はそのまま残ります。

### まとめ（Sanity でいけるか）

| 機能 | CMS に持つデータ | 表示 |
|------|------------------|------|
| **フクロウの相槌** | `owlMessages`（文字列の配列。任意） | 既存の `ArticleBodyWithOwl` に渡すだけ。 |
| **LINE誘導（文頭・文末）** | 持たない | 既存の `ArticleLineCTATop`・`ArticleFooterCTA` をテンプレートでそのまま表示。 |

**Sanity の記事スキーマに `owlMessages`（array of string）を追加し、記事ページでは「Sanity から取得したデータ」を今と同じコンポーネントに渡せば、フクロウの相槌も LINE 誘導も現状どおり残せます。**
